<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Steel Plate Weight Calculator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f0f2f5;
        padding: 20px;
        color: #333;
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #222;
      }

      #captureArea {
        background: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 100%;
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: #fff;
        min-width: 800px;
      }

      th,
      td {
        border: 1px solid #e0e0e0;
        padding: 10px;
        text-align: center;
        vertical-align: middle;
      }

      th {
        background-color: #f7f7f7;
        font-weight: 600;
        color: #444;
      }

      input,
      select {
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }

      button {
        margin: 5px;
        padding: 10px 18px;
        background: #007bff;
        color: white;
        border: none;
        font-weight: 500;
        font-size: 15px;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      button:hover {
        background: #0056b3;
      }

      .result {
        margin-top: 20px;
        font-size: 1.2em;
        font-weight: 600;
        color: #2d6a4f;
        text-align: center;
      }

      #detailsBlock {
        margin-top: 20px;
        padding: 15px;
        background: #e8f0fe;
        border-left: 4px solid #007bff;
        border-radius: 6px;
        font-family: monospace;
        white-space: pre-line;
        font-size: 14px;
      }

      /* Mobile View: Cards instead of table */
      @media (max-width: 768px) {
        table,
        thead,
        tbody,
        th,
        td,
        tr {
          display: block;
        }

        thead {
          display: none;
        }

        tr {
          margin-bottom: 15px;
          background: #fff;
          border-radius: 8px;
          box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
          padding: 12px;
        }

        td {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 8px 12px;
          border: none;
          border-bottom: 1px solid #eee;
        }

        td:last-child {
          border-bottom: none;
        }

        td::before {
          content: attr(data-label);
          font-weight: 600;
          flex: 1;
          text-align: left;
          padding-right: 10px;
          color: #555;
        }

        td > * {
          flex: 2;
          max-width: 60%;
        }

        input,
        select {
          font-size: 13px;
        }

        button {
          width: 100%;
          padding: 12px;
          font-size: 14px;
        }

        .action-buttons {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        #captureArea {
          padding: 15px;
        }

        .result {
          font-size: 1.1em;
        }

        #detailsBlock {
          font-size: 13px;
          word-break: break-word;
        }
      }

      /* Optional enhancements */
      .unit,
      .len_m,
      .len_mm,
      .len_ft,
      .len_in,
      .wid_m,
      .wid_mm,
      .wid_ft,
      .wid_in,
      .thickness_mm,
      .pieces {
        margin-bottom: 5px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Arial, sans-serif;
        background: #f6f8fa;
        padding: 16px;
        color: #333;
      }

      .container {
        max-width: 1000px;
        margin: auto;
        background: #fff;
        padding: 16px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: #222;
      }

      .card {
        background: #fafafa;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        overflow-x: auto;
      }

      .card.secondary {
        background: #f0f4f8;
      }

      .table-responsive {
        width: 100%;
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 600px;
      }

      thead {
        background: #e0e7ef;
      }

      th,
      td {
        padding: 12px 8px;
        text-align: center;
        border-bottom: 1px solid #ddd;
      }

      th {
        font-weight: bold;
        font-size: 0.95rem;
      }

      td input {
        width: 80px;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      .result {
        font-weight: bold;
        font-size: 1rem;
        margin-top: 10px;
        color: #2e7d32;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
      }

      .button-group button {
        padding: 10px 16px;
        border: none;
        border-radius: 5px;
        background-color: #1976d2;
        color: #fff;
        cursor: pointer;
        font-size: 0.95rem;
        transition: background-color 0.3s;
      }

      .button-group button:hover {
        background-color: #0d47a1;
      }

      @media (max-width: 768px) {
        th,
        td {
          font-size: 0.85rem;
          padding: 8px 6px;
        }

        td input {
          width: 100%;
        }

        table {
          min-width: unset;
        }

        .card {
          padding: 12px;
        }

        h2 {
          font-size: 1.3rem;
        }

        .button-group {
          flex-direction: column;
          gap: 10px;
        }

        .button-group button {
          width: 100%;
        }

        .result {
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>ðŸ§® Steel Plate Weight Calculator</h2>

      <div id="captureArea" class="card">
        <div class="table-responsive">
          <table id="dimensionTable">
            <thead>
              <tr>
                <th>Unit</th>
                <th>Length</th>
                <th>Width</th>
                <th>Thickness (mm)</th>
                <th>Pieces</th>
                <th>Weight (kg)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="result" id="result">âœ… Total Weight: 0.00 kg</div>

        <div id="detailsBlock" class="card secondary">
          <!-- Will fill with detailed description -->
        </div>
      </div>

      <div class="button-group">
        <button onclick="addRow()">âž• Add Row</button>
        <button onclick="calculateTotal()">âœ… Calculate</button>
        <button onclick="downloadAsImage()">ðŸ“¸ Download Image</button>
        <button onclick="downloadAsPDF()">ðŸ“„ Download PDF</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      function addRow() {
        const tbody = document.querySelector("#dimensionTable tbody");
        const row = document.createElement("tr");
        row.innerHTML = `
    <td>
      <select class="unit">
        <option value="m">Meters</option>
        <option value="mm">Millimeters</option>
        <option value="ft">Feet & Inches</option>
      </select>
    </td>
    <td>
      <div class="m-inputs">
        <input type="number" step="0.01" class="len_m" placeholder="Length m">
      </div>
      <div class="mm-inputs" style="display:none;">
        <input type="number" step="0.1" class="len_mm" placeholder="Length mm">
      </div>
      <div class="ft-inputs" style="display:none;">
        <input type="number" step="0.01" class="len_ft" placeholder="ft">
        <input type="number" step="0.01" class="len_in" placeholder="in">
      </div>
    </td>
    <td>
      <div class="m-inputs">
        <input type="number" step="0.01" class="wid_m" placeholder="Width m">
      </div>
      <div class="mm-inputs" style="display:none;">
        <input type="number" step="0.1" class="wid_mm" placeholder="Width mm">
      </div>
      <div class="ft-inputs" style="display:none;">
        <input type="number" step="0.01" class="wid_ft" placeholder="ft">
        <input type="number" step="0.01" class="wid_in" placeholder="in">
      </div>
    </td>
    <td>
      <input type="number" step="0.1" class="thickness_mm" placeholder="Thickness mm">
    </td>
    <td>
      <input type="number" step="1" class="pieces" placeholder="Qty">
    </td>
    <td>
      <span class="weightCell">0.00</span>
    </td>
    <td>
      <button onclick="this.closest('tr').remove(); calculateTotal();">ðŸ—‘ Remove</button>
    </td>
  `;
        tbody.appendChild(row);

        row.querySelector(".unit").addEventListener("change", function () {
          const unit = this.value;
          row
            .querySelectorAll(".m-inputs")
            .forEach(
              (el) => (el.style.display = unit === "m" ? "block" : "none")
            );
          row
            .querySelectorAll(".mm-inputs")
            .forEach(
              (el) => (el.style.display = unit === "mm" ? "block" : "none")
            );
          row
            .querySelectorAll(".ft-inputs")
            .forEach(
              (el) => (el.style.display = unit === "ft" ? "block" : "none")
            );
        });
      }

      // Add one initial row
      addRow();

      function calculateTotal() {
        const density = 7850; // kg/m3
        let totalWeight = 0;
        let description = "ðŸ“Œ *Detailed Results:*\n";

        document
          .querySelectorAll("#dimensionTable tbody tr")
          .forEach((row, i) => {
            const unit = row.querySelector(".unit").value;
            let length_m = 0;
            let width_m = 0;
            const thickness_mm =
              parseFloat(row.querySelector(".thickness_mm").value) || 0;
            const pieces = parseInt(row.querySelector(".pieces").value) || 0;
            let lenDisplay = "";
            let widDisplay = "";

            if (unit === "m") {
              const l = parseFloat(row.querySelector(".len_m").value) || 0;
              const w = parseFloat(row.querySelector(".wid_m").value) || 0;
              length_m = l;
              width_m = w;
              lenDisplay = `${l} m`;
              widDisplay = `${w} m`;
            } else if (unit === "mm") {
              const l = parseFloat(row.querySelector(".len_mm").value) || 0;
              const w = parseFloat(row.querySelector(".wid_mm").value) || 0;
              length_m = l / 1000;
              width_m = w / 1000;
              lenDisplay = `${l} mm`;
              widDisplay = `${w} mm`;
            } else if (unit === "ft") {
              const lf = parseFloat(row.querySelector(".len_ft").value) || 0;
              const li = parseFloat(row.querySelector(".len_in").value) || 0;
              const wf = parseFloat(row.querySelector(".wid_ft").value) || 0;
              const wi = parseFloat(row.querySelector(".wid_in").value) || 0;
              length_m = (lf * 12 + li) * 0.0254;
              width_m = (wf * 12 + wi) * 0.0254;
              lenDisplay = `${lf} ft ${li} in`;
              widDisplay = `${wf} ft ${wi} in`;
            }

            const thickness_m = thickness_mm / 1000;
            let weightEach = 0;
            if (length_m > 0 && width_m > 0 && thickness_m > 0 && pieces > 0) {
              const volume = length_m * width_m * thickness_m;
              weightEach = volume * density;
              totalWeight += weightEach * pieces;

              description += `Row ${
                i + 1
              }: ${lenDisplay} Ã— ${widDisplay} Ã— ${thickness_mm} mm Ã— ${pieces} pcs = ${(
                weightEach * pieces
              ).toFixed(2)} kg\n`;
            } else {
              description += `Row ${i + 1}: incomplete data\n`;
            }
            row.querySelector(".weightCell").innerText = (
              weightEach * pieces
            ).toFixed(2);
          });

        description += `âœ… Total Weight: ${totalWeight.toFixed(2)} kg`;
        document.getElementById(
          "result"
        ).innerText = `âœ… Total Weight: ${totalWeight.toFixed(2)} kg`;
        document.getElementById("detailsBlock").innerText = description;
      }

      function downloadAsImage() {
        html2canvas(document.querySelector("#captureArea"), { scale: 2 }).then(
          (canvas) => {
            const link = document.createElement("a");
            link.download = "steel_weight_results.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
          }
        );
      }

      async function downloadAsPDF() {
        const { jsPDF } = window.jspdf;
        const canvas = await html2canvas(
          document.querySelector("#captureArea"),
          { scale: 2 }
        );
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }

        pdf.save("steel_weight_results.pdf");
      }
    </script>
  </body>
</html>
